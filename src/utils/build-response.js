const { decrypt, convertDateTime, dateconvert, convertDate } = require('./helper.utils');
const {
	_agamaOption,
  _citacitaOption,
	_hobiOption,
	_jenjangsekolahOption,
	_statussekolahOption,
	_statusortuOption,
	_pendidikanOption,
	_pekerjaanOption,
	_jabatanOption,
	_mengajarOption,
	_penghasilanOption,
	_statustempattinggalOption,
	_jarakrumahOption,
	_transportasiOption,
	_wilayahOption,
} = require('../controllers/helper.service')
const dotenv = require('dotenv');
dotenv.config();
const BASE_URL = process.env.BASE_URL

function _buildResponseUser(dataUser, refreshToken, accessToken) {
	return {
		idUser: dataUser.idUser,
		consumerType: dataUser.consumerType,
		namaRole: dataUser.Role.namaRole,
		nama: dataUser.nama,
		username: dataUser.username,
		email: dataUser.email,
		password: dataUser.password,
		kataSandi: dataUser.kataSandi,
		tempat: dataUser.UserDetail.tempat,
		tanggalLahir: dataUser.UserDetail.tanggalLahir,
		jenisKelamin: dataUser.UserDetail.jenisKelamin,
		agama: dataUser.UserDetail.agama,
		telp: dataUser.UserDetail.telp,
		alamat: dataUser.UserDetail.alamat,
		provinsi: dataUser.UserDetail.provinsi,
		kabKota: dataUser.UserDetail.kabKota,
		kecamatan: dataUser.UserDetail.kecamatan,
		kelurahan: dataUser.UserDetail.kelurahan,
		kodePos: dataUser.UserDetail.kodePos,
		jabatanGuru: dataUser.UserDetail.jabatanGuru,
		mengajarBidang: dataUser.UserDetail.mengajarBidang,
		mengajarKelas: dataUser.UserDetail.mengajarKelas,
		waliKelas: dataUser.UserDetail.waliKelas,
		kelas: dataUser.UserDetail.kelas,
		fotoProfil: dataUser.UserDetail.fotoProfil ? `${BASE_URL}image/${dataUser.UserDetail.fotoProfil}` : `${BASE_URL}bahan/user.png`,
		statusAktif: true,
		refreshToken,
		accessToken
	}
}

async function _buildResponseAdmin(models, dataAdmin) {
	return {
		idUser: dataAdmin.idUser,
		consumerType: dataAdmin.consumerType,
		namaRole: dataAdmin.Role.namaRole,
		nama: dataAdmin.nama,
		username: dataAdmin.username,
		email: dataAdmin.email,
		password: dataAdmin.password,
		kataSandi: dataAdmin.kataSandi,
		tempat: dataAdmin.UserDetail.tempat,
		tanggalLahir: dataAdmin.UserDetail.tanggalLahir,
		jenisKelamin: dataAdmin.UserDetail.jenisKelamin,
		agama: dataAdmin.UserDetail.agama ? await _agamaOption({ models, kode: dataAdmin.UserDetail.agama }) : null,
		telp: dataAdmin.UserDetail.telp,
		alamat: dataAdmin.UserDetail.alamat,
		provinsi: dataAdmin.UserDetail.provinsi ? await _wilayahOption({ models, kode: dataAdmin.UserDetail.provinsi }) : null,
		kabKota: dataAdmin.UserDetail.kabKota ? await _wilayahOption({ models, kode: dataAdmin.UserDetail.kabKota }) : null,
		kecamatan: dataAdmin.UserDetail.kecamatan ? await _wilayahOption({ models, kode: dataAdmin.UserDetail.kecamatan }) : null,
		kelurahan: dataAdmin.UserDetail.kelurahan ? await _wilayahOption({ models, kode: dataAdmin.UserDetail.kelurahan }) : null,
		kodePos: dataAdmin.UserDetail.kodePos,
		fotoProfil: dataAdmin.UserDetail.fotoProfil ? `${BASE_URL}image/${dataAdmin.UserDetail.fotoProfil}` : `${BASE_URL}bahan/user.png`,
		statusAktif: dataAdmin.statusAktif,
	}
}

async function _buildResponseStruktural(models, dataStruktural) {
	return {
		idUser: dataStruktural.idUser,
		consumerType: dataStruktural.consumerType,
		nomorInduk: dataStruktural.UserDetail.nomorInduk,
		namaRole: dataStruktural.Role.namaRole,
		nama: dataStruktural.nama,
		username: dataStruktural.username,
		email: dataStruktural.email,
		password: dataStruktural.password,
		kataSandi: dataStruktural.kataSandi,
		tempat: dataStruktural.UserDetail.tempat,
		tanggalLahir: dataStruktural.UserDetail.tanggalLahir,
		jenisKelamin: dataStruktural.UserDetail.jenisKelamin,
		agama: dataStruktural.UserDetail.agama ? await _agamaOption({ models, kode: dataStruktural.UserDetail.agama }) : null,
		telp: dataStruktural.UserDetail.telp,
		alamat: dataStruktural.UserDetail.alamat,
		provinsi: dataStruktural.UserDetail.provinsi ? await _wilayahOption({ models, kode: dataStruktural.UserDetail.provinsi }) : null,
		kabKota: dataStruktural.UserDetail.kabKota ? await _wilayahOption({ models, kode: dataStruktural.UserDetail.kabKota }) : null,
		kecamatan: dataStruktural.UserDetail.kecamatan ? await _wilayahOption({ models, kode: dataStruktural.UserDetail.kecamatan }) : null,
		kelurahan: dataStruktural.UserDetail.kelurahan ? await _wilayahOption({ models, kode: dataStruktural.UserDetail.kelurahan }) : null,
		kodePos: dataStruktural.UserDetail.kodePos,
		pendidikanGuru: dataStruktural.UserDetail.pendidikanGuru ? await _pendidikanOption({ models, kode: dataStruktural.UserDetail.pendidikanGuru }) : null,
		jabatanGuru: dataStruktural.UserDetail.jabatanGuru ? await _jabatanOption({ models, kode: dataStruktural.UserDetail.jabatanGuru }) : null,
		mengajarBidang: dataStruktural.UserDetail.mengajarBidang ? await _mengajarOption({ models, kode: dataStruktural.UserDetail.mengajarBidang }) : null,
		mengajarKelas: dataStruktural.UserDetail.mengajarKelas,
		waliKelas: dataStruktural.UserDetail.waliKelas,
		fotoProfil: dataStruktural.UserDetail.fotoProfil ? `${BASE_URL}image/${dataStruktural.UserDetail.fotoProfil}` : `${BASE_URL}bahan/user.png`,
		statusAktif: dataStruktural.statusAktif,
	}
}

async function _buildResponseSiswaSiswi(models, dataSiswaSiswi) {
	return {
		idUser: dataSiswaSiswi.idUser,
		consumerType: dataSiswaSiswi.consumerType,
		nikSiswa: dataSiswaSiswi.UserDetail.nikSiswa,
		nomorInduk: dataSiswaSiswi.UserDetail.nomorInduk,
		namaRole: dataSiswaSiswi.Role.namaRole,
		nama: dataSiswaSiswi.nama,
		username: dataSiswaSiswi.username,
		email: dataSiswaSiswi.email,
		password: dataSiswaSiswi.password,
		kataSandi: dataSiswaSiswi.kataSandi,
		tempat: dataSiswaSiswi.UserDetail.tempat,
		tanggalLahir: dataSiswaSiswi.UserDetail.tanggalLahir,
		jenisKelamin: dataSiswaSiswi.UserDetail.jenisKelamin,
		agama: dataSiswaSiswi.UserDetail.agama ? await _agamaOption({ models, kode: dataSiswaSiswi.UserDetail.agama }) : null,
		anakKe: dataSiswaSiswi.UserDetail.anakKe,
		jumlahSaudara: dataSiswaSiswi.UserDetail.jumlahSaudara,
		hobi: dataSiswaSiswi.UserDetail.hobi ? await _hobiOption({ models, kode: dataSiswaSiswi.UserDetail.hobi }) : null,
		citaCita: dataSiswaSiswi.UserDetail.citaCita ? await _citacitaOption({ models, kode: dataSiswaSiswi.UserDetail.citaCita }) : null,
		dataSekolahSebelumnya: {
			jenjang: dataSiswaSiswi.UserDetail.jenjang ? await _jenjangsekolahOption({ models, kode: dataSiswaSiswi.UserDetail.jenjang }) : null,
			statusSekolah: dataSiswaSiswi.UserDetail.statusSekolah ? await _statussekolahOption({ models, kode: dataSiswaSiswi.UserDetail.statusSekolah }) : null,
			namaSekolah: dataSiswaSiswi.UserDetail.namaSekolah,
			npsn: dataSiswaSiswi.UserDetail.npsn,
			alamatSekolah: dataSiswaSiswi.UserDetail.alamatSekolah,
			kabkotSekolah: dataSiswaSiswi.UserDetail.kabkotSekolah ? await _wilayahOption({ models, kode: dataSiswaSiswi.UserDetail.kabkotSekolah }) : null,
			noPesertaUN: dataSiswaSiswi.UserDetail.noPesertaUN,
			noSKHUN: dataSiswaSiswi.UserDetail.noSKHUN,
			noIjazah: dataSiswaSiswi.UserDetail.noIjazah,
			nilaiUN: dataSiswaSiswi.UserDetail.nilaiUN,
		},
		noKK: dataSiswaSiswi.UserDetail.noKK,
		namaKK: dataSiswaSiswi.UserDetail.namaKK,
		dataOrangtua: {
			dataAyah: {
				namaAyah: dataSiswaSiswi.UserDetail.namaAyah,
				tahunAyah: dataSiswaSiswi.UserDetail.tahunAyah,
				statusAyah: dataSiswaSiswi.UserDetail.statusAyah ? await _statusortuOption({ models, kode: dataSiswaSiswi.UserDetail.statusAyah }) : null,
				nikAyah: dataSiswaSiswi.UserDetail.nikAyah,
				pendidikanAyah: dataSiswaSiswi.UserDetail.pendidikanAyah ? await _pendidikanOption({ models, kode: dataSiswaSiswi.UserDetail.pendidikanAyah }) : null,
				pekerjaanAyah: dataSiswaSiswi.UserDetail.pekerjaanAyah ? await _pekerjaanOption({ models, kode: dataSiswaSiswi.UserDetail.pekerjaanAyah }) : null,
				telpAyah: dataSiswaSiswi.UserDetail.telpAyah,
			},
			dataIbu: {
				namaIbu: dataSiswaSiswi.UserDetail.namaIbu,
				tahunIbu: dataSiswaSiswi.UserDetail.tahunIbu,
				statusIbu: dataSiswaSiswi.UserDetail.statusIbu ? await _statusortuOption({ models, kode: dataSiswaSiswi.UserDetail.statusIbu }) : null,
				nikIbu: dataSiswaSiswi.UserDetail.nikIbu,
				pendidikanIbu: dataSiswaSiswi.UserDetail.pendidikanIbu ? await _pendidikanOption({ models, kode: dataSiswaSiswi.UserDetail.pendidikanIbu }) : null,
				pekerjaanIbu: dataSiswaSiswi.UserDetail.pekerjaanIbu ? await _pekerjaanOption({ models, kode: dataSiswaSiswi.UserDetail.pekerjaanIbu }) : null,
				telpIbu: dataSiswaSiswi.UserDetail.telpIbu,
			},
			dataWali: {
				namaWali: dataSiswaSiswi.UserDetail.namaWali,
				tahunWali: dataSiswaSiswi.UserDetail.tahunWali,
				nikWali: dataSiswaSiswi.UserDetail.nikWali,
				pendidikanWali: dataSiswaSiswi.UserDetail.pendidikanWali ? await _pendidikanOption({ models, kode: dataSiswaSiswi.UserDetail.pendidikanWali }) : null,
				pekerjaanWali: dataSiswaSiswi.UserDetail.pekerjaanWali ? await _pekerjaanOption({ models, kode: dataSiswaSiswi.UserDetail.pekerjaanWali }) : null,
				telpWali: dataSiswaSiswi.UserDetail.telpWali,
			}
		},
		penghasilan: dataSiswaSiswi.UserDetail.penghasilan ? await _penghasilanOption({ models, kode: dataSiswaSiswi.UserDetail.penghasilan }) : null,
		dataAlamatOrangtua: {
			telp: dataSiswaSiswi.UserDetail.telp,
			alamat: dataSiswaSiswi.UserDetail.alamat,
			provinsi: dataSiswaSiswi.UserDetail.provinsi ? await _wilayahOption({ models, kode: dataSiswaSiswi.UserDetail.provinsi }) : null,
			kabKota: dataSiswaSiswi.UserDetail.kabKota ? await _wilayahOption({ models, kode: dataSiswaSiswi.UserDetail.kabKota }) : null,
			kecamatan: dataSiswaSiswi.UserDetail.kecamatan ? await _wilayahOption({ models, kode: dataSiswaSiswi.UserDetail.kecamatan }) : null,
			kelurahan: dataSiswaSiswi.UserDetail.kelurahan ? await _wilayahOption({ models, kode: dataSiswaSiswi.UserDetail.kelurahan }) : null,
			kodePos: dataSiswaSiswi.UserDetail.kodePos,
		},
		kelas: dataSiswaSiswi.UserDetail.kelas,
		dataLainnya: {
			statusTempatTinggal: dataSiswaSiswi.UserDetail.statusTempatTinggal ? await _statustempattinggalOption({ models, kode: dataSiswaSiswi.UserDetail.statusTempatTinggal }) : null,
			jarakRumah: dataSiswaSiswi.UserDetail.jarakRumah ? await _jarakrumahOption({ models, kode: dataSiswaSiswi.UserDetail.jarakRumah }) : null,
			transportasi: dataSiswaSiswi.UserDetail.transportasi ? await _transportasiOption({ models, kode: dataSiswaSiswi.UserDetail.transportasi }) : null,
		},
		fotoProfil: dataSiswaSiswi.UserDetail.fotoProfil ? `${BASE_URL}image/${dataSiswaSiswi.UserDetail.fotoProfil}` : `${BASE_URL}bahan/user.png`,
		berkas: {
			fcIjazah: dataSiswaSiswi.UserDetail.fcIjazah ? `${BASE_URL}pdf/${dataSiswaSiswi.UserDetail.fcIjazah}` : null,
			fcSKHUN: dataSiswaSiswi.UserDetail.fcSKHUN ? `${BASE_URL}pdf/${dataSiswaSiswi.UserDetail.fcSKHUN}` : null,
			fcKK: dataSiswaSiswi.UserDetail.fcKK ? `${BASE_URL}pdf/${dataSiswaSiswi.UserDetail.fcKK}` : null,
			fcKTPOrtu: dataSiswaSiswi.UserDetail.fcKTPOrtu ? `${BASE_URL}pdf/${dataSiswaSiswi.UserDetail.fcKTPOrtu}` : null,
			fcAktaLahir: dataSiswaSiswi.UserDetail.fcAktaLahir ? `${BASE_URL}pdf/${dataSiswaSiswi.UserDetail.fcAktaLahir}` : null,
			fcSKL: dataSiswaSiswi.UserDetail.fcSKL ? `${BASE_URL}pdf/${dataSiswaSiswi.UserDetail.fcSKL}` : null,
		},
		mutasiAkun: dataSiswaSiswi.mutasiAkun,
		validasiAkun: dataSiswaSiswi.validasiAkun,
		statusAktif: dataSiswaSiswi.statusAktif,
	}
}

module.exports = {
  _buildResponseUser,
  _buildResponseAdmin,
  _buildResponseStruktural,
  _buildResponseSiswaSiswi,
}